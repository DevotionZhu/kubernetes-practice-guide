<!DOCTYPE html>
<html lang="zh" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.65.3" />
    <meta name="description" content="Kubernetes 实践指南">
<meta name="author" content="roc">

    <link rel="icon" href="/images/favicon.png" type="image/png">

    <title>神秘的溢出与丢包</title>

    <script>
      window.algoliaAppID='B6Q6PSGUV5';
      window.algoliaKey='5b4678e9995fe4211c4fa43ad2ffdab5';
      window.algoliaIndex='kubernetes-practice-guide-zh';
    </script>
    
    <script src='https://kubetencent-1251707795.cos.accelerate.myqcloud.com/js/bundle.min.8d534562810f42a5942ec72a0b7ae599c8bf0c96a4c8d6fafffa9bf21fce9d77.js'></script>
    
    
    <link rel="stylesheet"
      href='https://kubetencent-1251707795.cos.accelerate.myqcloud.com/css/bundle.min.b0e6163350b1169d986890f4bd317db6286105863b7a53274abdb5c8d935eaa1.css'>
    

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    
  </head>
  <body class="" data-url="/avoid/cases/kubernetes-overflow-and-drop/">
    <nav id="sidebar" class="showVisitedLinks">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="https://k8s.imroc.io/" style="display:block">
  <div style="width:100%; height:100%;" >
    <img src="https://res.cloudinary.com/imroc/image/upload/c_scale,w_64/v1583293443/kubernetes-practice-guide/img/kubernetes.png" />
    <div style="height:100%; margin-bottom:3px; font-weight: bold;">Kubernetes 实践指南</div>
  </div>
</a>
    </div>
    
        
<div class="aa-input-container" id="aa-input-container">
    <input type="search" id="aa-search-input" class="aa-input-search" placeholder="搜索..."
        name="search" autocomplete="off" />
    <svg class="aa-input-icon" viewBox="654 -372 1664 1664">
        <path
            d="M1806,332c0-123.3-43.8-228.8-131.5-316.5C1586.8-72.2,1481.3-116,1358-116s-228.8,43.8-316.5,131.5  C953.8,103.2,910,208.7,910,332s43.8,228.8,131.5,316.5C1129.2,736.2,1234.7,780,1358,780s228.8-43.8,316.5-131.5  C1762.2,560.8,1806,455.3,1806,332z M2318,1164c0,34.7-12.7,64.7-38,90s-55.3,38-90,38c-36,0-66-12.7-90-38l-343-342  c-119.3,82.7-252.3,124-399,124c-95.3,0-186.5-18.5-273.5-55.5s-162-87-225-150s-113-138-150-225S654,427.3,654,332  s18.5-186.5,55.5-273.5s87-162,150-225s138-113,225-150S1262.7-372,1358-372s186.5,18.5,273.5,55.5s162,87,225,150s113,138,150,225  S2062,236.7,2062,332c0,146.7-41.3,279.7-124,399l343,343C2305.7,1098.7,2318,1128.7,2318,1164z" />
    </svg>
</div>

<script type="text/javascript">
    
        var baseurl = "https:\/\/k8s.imroc.io\/";
    
</script>


    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
  
 

          
          




 
  
    
    <li data-nav-id="/deploy/" title="部署指南" class="dd-item 
        
        
        
        ">
      <a href="/deploy/">
          部署指南
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
      <li data-nav-id="/deploy/selection/" title="方案选型" class="dd-item ">
        <a href="/deploy/selection/">
        方案选型
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/deploy/kubespray/" title="使用 kubespray 部署" class="dd-item ">
        <a href="/deploy/kubespray/">
        使用 kubespray 部署
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/deploy/manual/" title="手工部署" class="dd-item 
        
        
        
        ">
      <a href="/deploy/manual/">
          手工部署
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            




 
  
    
      <li data-nav-id="/deploy/manual/prepare/" title="部署前的准备工作" class="dd-item ">
        <a href="/deploy/manual/prepare/">
        部署前的准备工作
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/deploy/manual/bootstrapping-etcd/" title="部署 ETCD" class="dd-item ">
        <a href="/deploy/manual/bootstrapping-etcd/">
        部署 ETCD
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/deploy/manual/bootstrapping-master/" title="部署 Master" class="dd-item ">
        <a href="/deploy/manual/bootstrapping-master/">
        部署 Master
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/deploy/manual/bootstrapping-worker-nodes/" title="部署 Worker 节点" class="dd-item ">
        <a href="/deploy/manual/bootstrapping-worker-nodes/">
        部署 Worker 节点
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/deploy/manual/deploy-critical-addons/" title="部署关键组件" class="dd-item ">
        <a href="/deploy/manual/deploy-critical-addons/">
        部署关键组件
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/deploy/addons/" title="附加组件" class="dd-item 
        
        
        
        ">
      <a href="/deploy/addons/">
          附加组件
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            




 
  
    
      <li data-nav-id="/deploy/addons/kube-proxy/" title="以 Daemonset 方式部署 kube-proxy" class="dd-item ">
        <a href="/deploy/addons/kube-proxy/">
        以 Daemonset 方式部署 kube-proxy
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/deploy/addons/coredns/" title="部署 CoreDNS" class="dd-item ">
        <a href="/deploy/addons/coredns/">
        部署 CoreDNS
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/deploy/appendix/" title="附录" class="dd-item 
        
        
        
        ">
      <a href="/deploy/appendix/">
          附录
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            




 
  
    
      <li data-nav-id="/deploy/appendix/install-kubectl/" title="安装 kubectl" class="dd-item ">
        <a href="/deploy/appendix/install-kubectl/">
        安装 kubectl
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/ingress/" title="Ingress 指南" class="dd-item 
        
        
        
        ">
      <a href="/ingress/">
          Ingress 指南
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
      <li data-nav-id="/ingress/understand/" title="彻底理解 Ingress" class="dd-item ">
        <a href="/ingress/understand/">
        彻底理解 Ingress
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ingress/choose/" title="Ingress 方案选型" class="dd-item ">
        <a href="/ingress/choose/">
        Ingress 方案选型
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ingress/nginx-ingress/" title="Nginx Ingress" class="dd-item 
        
        
        
        ">
      <a href="/ingress/nginx-ingress/">
          Nginx Ingress
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            




 
  
    
      <li data-nav-id="/ingress/nginx-ingress/install-nginx-ingress/" title="安装 nginx ingress controller" class="dd-item ">
        <a href="/ingress/nginx-ingress/install-nginx-ingress/">
        安装 nginx ingress controller
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ingress/traefik-ingress/" title="Traefik Ingress" class="dd-item 
        
        
        
        ">
      <a href="/ingress/traefik-ingress/">
          Traefik Ingress
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            




 
  
    
      <li data-nav-id="/ingress/traefik-ingress/install-traefik-ingress/" title="安装 traefik ingress controller" class="dd-item ">
        <a href="/ingress/traefik-ingress/install-traefik-ingress/">
        安装 traefik ingress controller
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/ingress/traefik-ingress/use-traefik-to-support-login/" title="使用 Traefik V2 让你的后台管理页面支持登录" class="dd-item ">
        <a href="/ingress/traefik-ingress/use-traefik-to-support-login/">
        使用 Traefik V2 让你的后台管理页面支持登录
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/metrics/" title="Metrics 指南" class="dd-item 
        
        
        
        ">
      <a href="/metrics/">
          Metrics 指南
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/configuration/" title="配置管理" class="dd-item 
        
        
        
        ">
      <a href="/configuration/">
          配置管理
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/configuration/helm/" title="使用 Helm 管理集群资源" class="dd-item 
        
        
        
        ">
      <a href="/configuration/helm/">
          使用 Helm 管理集群资源
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            




 
  
    
      <li data-nav-id="/configuration/helm/install-helm/" title="安装 Helm" class="dd-item ">
        <a href="/configuration/helm/install-helm/">
        安装 Helm
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/configuration/helm/upgrade-helm-v2-to-v3/" title="Helm V2 迁移到 V3" class="dd-item ">
        <a href="/configuration/helm/upgrade-helm-v2-to-v3/">
        Helm V2 迁移到 V3
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/configuration/helm/helm-faq/" title="Helm 常见问题" class="dd-item ">
        <a href="/configuration/helm/helm-faq/">
        Helm 常见问题
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/troubleshooting/" title="排错指南" class="dd-item 
        
        
        
        ">
      <a href="/troubleshooting/">
          排错指南
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/troubleshooting/trick/" title="排错技巧" class="dd-item 
        
        
        
        ">
      <a href="/troubleshooting/trick/">
          排错技巧
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            




 
  
    
      <li data-nav-id="/troubleshooting/trick/analysis-exitcode/" title="分析 ExitCode 定位 Pod 异常退出原因" class="dd-item ">
        <a href="/troubleshooting/trick/analysis-exitcode/">
        分析 ExitCode 定位 Pod 异常退出原因
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/troubleshooting/trick/use-systemtap-to-locate-problems/" title="使用 Systemtap 定位疑难杂症" class="dd-item ">
        <a href="/troubleshooting/trick/use-systemtap-to-locate-problems/">
        使用 Systemtap 定位疑难杂症
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/troubleshooting/trick/capture-packets-in-container/" title="容器内抓包定位网络问题" class="dd-item ">
        <a href="/troubleshooting/trick/capture-packets-in-container/">
        容器内抓包定位网络问题
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/troubleshooting/handle/" title="处理实践" class="dd-item 
        
        
        
        ">
      <a href="/troubleshooting/handle/">
          处理实践
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            




 
  
    
      <li data-nav-id="/troubleshooting/handle/arp_cache-overflow/" title="arp_cache 溢出" class="dd-item ">
        <a href="/troubleshooting/handle/arp_cache-overflow/">
        arp_cache 溢出
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/troubleshooting/handle/runnig-out-of-inotify-watches/" title="inotify watch 耗尽" class="dd-item ">
        <a href="/troubleshooting/handle/runnig-out-of-inotify-watches/">
        inotify watch 耗尽
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/troubleshooting/handle/pid-full/" title="PID 耗尽" class="dd-item ">
        <a href="/troubleshooting/handle/pid-full/">
        PID 耗尽
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/troubleshooting/handle/memory-fragmentation/" title="内存碎片化" class="dd-item ">
        <a href="/troubleshooting/handle/memory-fragmentation/">
        内存碎片化
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/troubleshooting/handle/disk-full/" title="磁盘爆满" class="dd-item ">
        <a href="/troubleshooting/handle/disk-full/">
        磁盘爆满
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/troubleshooting/handle/high-load/" title="高负载" class="dd-item ">
        <a href="/troubleshooting/handle/high-load/">
        高负载
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/troubleshooting/node/" title="节点排错" class="dd-item 
        
        
        
        ">
      <a href="/troubleshooting/node/">
          节点排错
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            




 
  
    
      <li data-nav-id="/troubleshooting/node/arp_cache-neighbor-table-overflow/" title="arp_cache: neighbor table overflow! (arp缓存溢出)" class="dd-item ">
        <a href="/troubleshooting/node/arp_cache-neighbor-table-overflow/">
        arp_cache: neighbor table overflow! (arp缓存溢出)
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/troubleshooting/node/cannot-allocate-memory/" title="Cannot allocate memory" class="dd-item ">
        <a href="/troubleshooting/node/cannot-allocate-memory/">
        Cannot allocate memory
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/troubleshooting/node/no-space-left-on-device/" title="no space left on device" class="dd-item ">
        <a href="/troubleshooting/node/no-space-left-on-device/">
        no space left on device
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/troubleshooting/node/not-ready/" title="Node NotReady" class="dd-item ">
        <a href="/troubleshooting/node/not-ready/">
        Node NotReady
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/troubleshooting/node/kernel-solft-lockup/" title="soft lockup (内核软死锁)" class="dd-item ">
        <a href="/troubleshooting/node/kernel-solft-lockup/">
        soft lockup (内核软死锁)
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/troubleshooting/pod/" title="Pod 排错" class="dd-item 
        
        
        
        ">
      <a href="/troubleshooting/pod/">
          Pod 排错
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            




 
  
    
      <li data-nav-id="/troubleshooting/pod/slow-terminating/" title="Pod Terminating 慢" class="dd-item ">
        <a href="/troubleshooting/pod/slow-terminating/">
        Pod Terminating 慢
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/troubleshooting/pod/keep-containercreating-or-waiting/" title="Pod 一直处于 ContainerCreating 或 Waiting 状态" class="dd-item ">
        <a href="/troubleshooting/pod/keep-containercreating-or-waiting/">
        Pod 一直处于 ContainerCreating 或 Waiting 状态
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/troubleshooting/pod/keep-error/" title="Pod 一直处于 Error 状态" class="dd-item ">
        <a href="/troubleshooting/pod/keep-error/">
        Pod 一直处于 Error 状态
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/troubleshooting/pod/keep-imageinspecterror/" title="Pod 一直处于 ImageInspectError 状态" class="dd-item ">
        <a href="/troubleshooting/pod/keep-imageinspecterror/">
        Pod 一直处于 ImageInspectError 状态
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/troubleshooting/pod/keep-imagepullbackoff/" title="Pod 一直处于 ImagePullBackOff 状态" class="dd-item ">
        <a href="/troubleshooting/pod/keep-imagepullbackoff/">
        Pod 一直处于 ImagePullBackOff 状态
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/troubleshooting/pod/keep-pending/" title="Pod 一直处于 Pending 状态" class="dd-item ">
        <a href="/troubleshooting/pod/keep-pending/">
        Pod 一直处于 Pending 状态
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/troubleshooting/pod/keep-terminating/" title="Pod 一直处于 Terminating 状态" class="dd-item ">
        <a href="/troubleshooting/pod/keep-terminating/">
        Pod 一直处于 Terminating 状态
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/troubleshooting/pod/keep-unkown/" title="Pod 一直处于 Unknown 状态" class="dd-item ">
        <a href="/troubleshooting/pod/keep-unkown/">
        Pod 一直处于 Unknown 状态
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/troubleshooting/pod/healthcheck-failed/" title="Pod 健康检查失败" class="dd-item ">
        <a href="/troubleshooting/pod/healthcheck-failed/">
        Pod 健康检查失败
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/troubleshooting/pod/keep-crashloopbackoff/" title="Pod 处于 CrashLoopBackOff 状态" class="dd-item ">
        <a href="/troubleshooting/pod/keep-crashloopbackoff/">
        Pod 处于 CrashLoopBackOff 状态
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/troubleshooting/pod/container-proccess-exit-by-itself/" title="容器进程主动退出" class="dd-item ">
        <a href="/troubleshooting/pod/container-proccess-exit-by-itself/">
        容器进程主动退出
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/troubleshooting/network/" title="网络排错" class="dd-item 
        
        
        
        ">
      <a href="/troubleshooting/network/">
          网络排错
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            




 
  
    
      <li data-nav-id="/troubleshooting/network/manual/" title="网络排错手册" class="dd-item ">
        <a href="/troubleshooting/network/manual/">
        网络排错手册
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/troubleshooting/network/dns/" title="DNS 解析异常" class="dd-item ">
        <a href="/troubleshooting/network/dns/">
        DNS 解析异常
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/troubleshooting/network/lb-healthcheck-failed/" title="LB 健康检查失败" class="dd-item ">
        <a href="/troubleshooting/network/lb-healthcheck-failed/">
        LB 健康检查失败
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/troubleshooting/network/service-unrecheable/" title="Service 不通" class="dd-item ">
        <a href="/troubleshooting/network/service-unrecheable/">
        Service 不通
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/troubleshooting/network/service-cannot-resolve/" title="Service 无法解析" class="dd-item ">
        <a href="/troubleshooting/network/service-cannot-resolve/">
        Service 无法解析
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/troubleshooting/network/low-throughput/" title="网络性能差" class="dd-item ">
        <a href="/troubleshooting/network/low-throughput/">
        网络性能差
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/troubleshooting/others/" title="其它排错" class="dd-item 
        
        
        
        ">
      <a href="/troubleshooting/others/">
          其它排错
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            




 
  
    
      <li data-nav-id="/troubleshooting/others/slow-apiserver/" title="APIServer 响应慢" class="dd-item ">
        <a href="/troubleshooting/others/slow-apiserver/">
        APIServer 响应慢
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/troubleshooting/others/daemonset-not-scheduled/" title="Daemonset 没有被调度" class="dd-item ">
        <a href="/troubleshooting/others/daemonset-not-scheduled/">
        Daemonset 没有被调度
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/troubleshooting/others/job-cannot-delete/" title="Job 无法被删除" class="dd-item ">
        <a href="/troubleshooting/others/job-cannot-delete/">
        Job 无法被删除
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/troubleshooting/others/kubectl-exec-or-logs-failed/" title="kubectl 执行 exec 或 logs 失败" class="dd-item ">
        <a href="/troubleshooting/others/kubectl-exec-or-logs-failed/">
        kubectl 执行 exec 或 logs 失败
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/troubleshooting/others/namespace-stuck-on-terminating/" title="Namespace 卡在 Terminating" class="dd-item ">
        <a href="/troubleshooting/others/namespace-stuck-on-terminating/">
        Namespace 卡在 Terminating
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/troubleshooting/others/node-all-gone/" title="Node 全部消失" class="dd-item ">
        <a href="/troubleshooting/others/node-all-gone/">
        Node 全部消失
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/avoid/" title="避坑指南" class="dd-item 
        parent
        
        
        ">
      <a href="/avoid/">
          避坑指南
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
      <li data-nav-id="/avoid/dotnet-configuration-auto-reload/" title=".Net Core 配置文件在Kubernetes中无法热加载" class="dd-item ">
        <a href="/avoid/dotnet-configuration-auto-reload/">
        .Net Core 配置文件在Kubernetes中无法热加载
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/avoid/cgroup-leaking/" title="cgroup 泄露" class="dd-item ">
        <a href="/avoid/cgroup-leaking/">
        cgroup 泄露
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/avoid/conntrack-conflict/" title="conntrack 冲突导致丢包" class="dd-item ">
        <a href="/avoid/conntrack-conflict/">
        conntrack 冲突导致丢包
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/avoid/tcp_tw_recycle-causes-packet-loss/" title="tcp tw recycle 引发丢包" class="dd-item ">
        <a href="/avoid/tcp_tw_recycle-causes-packet-loss/">
        tcp tw recycle 引发丢包
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/avoid/nodelocal-dns/" title="使用 NodeLocal DNS (缓存)" class="dd-item ">
        <a href="/avoid/nodelocal-dns/">
        使用 NodeLocal DNS (缓存)
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/avoid/handle-cgroup-oom-in-userspace-with-oom-guard/" title="使用 oom-guard 在用户态处理 cgroup OOM" class="dd-item ">
        <a href="/avoid/handle-cgroup-oom-in-userspace-with-oom-guard/">
        使用 oom-guard 在用户态处理 cgroup OOM
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/avoid/scale-keepalive-service/" title="解决长连接服务扩容失效" class="dd-item ">
        <a href="/avoid/scale-keepalive-service/">
        解决长连接服务扩容失效
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/avoid/cases/" title="踩坑分享" class="dd-item 
        parent
        
        
        ">
      <a href="/avoid/cases/">
          踩坑分享
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            




 
  
    
      <li data-nav-id="/avoid/cases/arp-cache-overflow-causes-healthcheck-failed/" title="ARP 缓存爆满导致健康检查失败" class="dd-item ">
        <a href="/avoid/cases/arp-cache-overflow-causes-healthcheck-failed/">
        ARP 缓存爆满导致健康检查失败
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/avoid/cases/dns-lookup-5s-delay/" title="DNS 5 秒延时" class="dd-item ">
        <a href="/avoid/cases/dns-lookup-5s-delay/">
        DNS 5 秒延时
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/avoid/cases/dns-resolution-abnormal/" title="DNS 解析异常" class="dd-item ">
        <a href="/avoid/cases/dns-resolution-abnormal/">
        DNS 解析异常
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/avoid/cases/schemaerror-when-using-kubectl-apply-or-edit/" title="kubectl edit 或者 apply 报 SchemaError" class="dd-item ">
        <a href="/avoid/cases/schemaerror-when-using-kubectl-apply-or-edit/">
        kubectl edit 或者 apply 报 SchemaError
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/avoid/cases/low-cps-from-lb-to-nodeport/" title="LB 压测 NodePort CPS 低" class="dd-item ">
        <a href="/avoid/cases/low-cps-from-lb-to-nodeport/">
        LB 压测 NodePort CPS 低
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/avoid/cases/livenesprobe-failed-occasionally/" title="Pod 偶尔存活检查失败" class="dd-item ">
        <a href="/avoid/cases/livenesprobe-failed-occasionally/">
        Pod 偶尔存活检查失败
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/avoid/cases/high-legacy-from-pod-to-another-apiserver/" title="Pod 访问另一个集群的 apiserver 有延时" class="dd-item ">
        <a href="/avoid/cases/high-legacy-from-pod-to-another-apiserver/">
        Pod 访问另一个集群的 apiserver 有延时
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/avoid/cases/kubernetes-overflow-and-drop/" title="神秘的溢出与丢包" class="dd-item active">
        <a href="/avoid/cases/kubernetes-overflow-and-drop/">
        神秘的溢出与丢包
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/avoid/cases/lb-with-local-externaltrafficpolicy-timeout-occasionally/" title="访问 externalTrafficPolicy 为 Local 的 Service 对应 LB 有时超时" class="dd-item ">
        <a href="/avoid/cases/lb-with-local-externaltrafficpolicy-timeout-occasionally/">
        访问 externalTrafficPolicy 为 Local 的 Service 对应 LB 有时超时
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/avoid/cases/no-route-to-host/" title="诡异的 No route to host" class="dd-item ">
        <a href="/avoid/cases/no-route-to-host/">
        诡异的 No route to host
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/avoid/cases/cross-vpc-connect-nodeport-timeout/" title="跨 VPC 访问 NodePort 经常超时" class="dd-item ">
        <a href="/avoid/cases/cross-vpc-connect-nodeport-timeout/">
        跨 VPC 访问 NodePort 经常超时
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/avoid/cases/eviction-leads-to-service-disruption/" title="驱逐导致服务中断" class="dd-item ">
        <a href="/avoid/cases/eviction-leads-to-service-disruption/">
        驱逐导致服务中断
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/security/" title="安全指南" class="dd-item 
        
        
        
        ">
      <a href="/security/">
          安全指南
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/security/user/" title="用户管理" class="dd-item 
        
        
        
        ">
      <a href="/security/user/">
          用户管理
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            




 
  
    
      <li data-nav-id="/security/user/create-user-using-csr-api/" title="利用 CSR API 创建用户" class="dd-item ">
        <a href="/security/user/create-user-using-csr-api/">
        利用 CSR API 创建用户
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/security/permission/" title="集群权限控制" class="dd-item 
        
        
        
        ">
      <a href="/security/permission/">
          集群权限控制
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            




 
  
    
      <li data-nav-id="/security/permission/app/" title="控制应用权限" class="dd-item ">
        <a href="/security/permission/app/">
        控制应用权限
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/security/permission/user/" title="控制用户权限" class="dd-item ">
        <a href="/security/permission/user/">
        控制用户权限
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/security/cert/" title="集群证书管理" class="dd-item 
        
        
        
        ">
      <a href="/security/cert/">
          集群证书管理
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            




 
  
    
      <li data-nav-id="/security/cert/install-cert-manger/" title="安装 cert-manager" class="dd-item ">
        <a href="/security/cert/install-cert-manger/">
        安装 cert-manager
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/security/cert/autogenerate-certificate-with-cert-manager/" title="使用 cert-manager 自动生成证书" class="dd-item ">
        <a href="/security/cert/autogenerate-certificate-with-cert-manager/">
        使用 cert-manager 自动生成证书
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/best-practice/" title="最佳实践" class="dd-item 
        
        
        
        ">
      <a href="/best-practice/">
          最佳实践
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/best-practice/deploy/" title="服务部署最佳实践" class="dd-item 
        
        
        
        ">
      <a href="/best-practice/deploy/">
          服务部署最佳实践
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            




 
  
    
      <li data-nav-id="/best-practice/deploy/resource-utilization/" title="如何合理利用资源" class="dd-item ">
        <a href="/best-practice/deploy/resource-utilization/">
        如何合理利用资源
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/best-practice/deploy/highly-available/" title="如何提高服务可用性" class="dd-item ">
        <a href="/best-practice/deploy/highly-available/">
        如何提高服务可用性
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/best-practice/etcd/" title="ETCD 优化" class="dd-item ">
        <a href="/best-practice/etcd/">
        ETCD 优化
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/best-practice/master/" title="Master 优化" class="dd-item ">
        <a href="/best-practice/master/">
        Master 优化
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/best-practice/kernel/" title="内核参数优化" class="dd-item ">
        <a href="/best-practice/kernel/">
        内核参数优化
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/trick/" title="奇技淫巧" class="dd-item 
        
        
        
        ">
      <a href="/trick/">
          奇技淫巧
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
      <li data-nav-id="/trick/efficient-kubectl/" title="kubectl 高效技巧" class="dd-item ">
        <a href="/trick/efficient-kubectl/">
        kubectl 高效技巧
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/trick/yaml/" title="yaml 片段" class="dd-item 
        
        
        
        ">
      <a href="/trick/yaml/">
          yaml 片段
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            




 
  
    
      <li data-nav-id="/trick/yaml/deployment/" title="Deployment" class="dd-item ">
        <a href="/trick/yaml/deployment/">
        Deployment
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/trick/yaml/affnity/" title="亲和与反亲和" class="dd-item ">
        <a href="/trick/yaml/affnity/">
        亲和与反亲和
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/trick/perf-in-container/" title="在容器内使用 perf" class="dd-item ">
        <a href="/trick/perf-in-container/">
        在容器内使用 perf
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/trick/shell/" title="实用命令与脚本" class="dd-item 
        
        
        
        ">
      <a href="/trick/shell/">
          实用命令与脚本
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            




 
  
    
      <li data-nav-id="/trick/shell/pod/" title="Pod 相关脚本" class="dd-item ">
        <a href="/trick/shell/pod/">
        Pod 相关脚本
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/trick/shell/network/" title="网络调试相关脚本" class="dd-item ">
        <a href="/trick/shell/network/">
        网络调试相关脚本
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/trick/shell/node/" title="节点相关脚本" class="dd-item ">
        <a href="/trick/shell/node/">
        节点相关脚本
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/trick/wildcard-domain-forward/" title="泛域名动态转发 Service" class="dd-item ">
        <a href="/trick/wildcard-domain-forward/">
        泛域名动态转发 Service
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/monitoring/" title="监控指南" class="dd-item 
        
        
        
        ">
      <a href="/monitoring/">
          监控指南
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
      <li data-nav-id="/monitoring/kube-prometheus-quickstart/" title="使用 kube-promethues 快速上手集群监控" class="dd-item ">
        <a href="/monitoring/kube-prometheus-quickstart/">
        使用 kube-promethues 快速上手集群监控
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/monitoring/build-cloud-native-large-scale-distributed-monitoring-system/" title="打造云原生大型分布式监控系统" class="dd-item 
        
        
        
        ">
      <a href="/monitoring/build-cloud-native-large-scale-distributed-monitoring-system/">
          打造云原生大型分布式监控系统
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            




 
  
    
      <li data-nav-id="/monitoring/build-cloud-native-large-scale-distributed-monitoring-system/optimize-prometheus-in-large-scale/" title="大规模场景下 Prometheus 的优化手段" class="dd-item ">
        <a href="/monitoring/build-cloud-native-large-scale-distributed-monitoring-system/optimize-prometheus-in-large-scale/">
        大规模场景下 Prometheus 的优化手段
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/monitoring/build-cloud-native-large-scale-distributed-monitoring-system/thanos-arch/" title="Thanos 架构详解" class="dd-item ">
        <a href="/monitoring/build-cloud-native-large-scale-distributed-monitoring-system/thanos-arch/">
        Thanos 架构详解
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/monitoring/build-cloud-native-large-scale-distributed-monitoring-system/thanos-deploy/" title="Thanos 部署与实践" class="dd-item ">
        <a href="/monitoring/build-cloud-native-large-scale-distributed-monitoring-system/thanos-deploy/">
        Thanos 部署与实践
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/monitoring/promql/" title="PromQL 技巧" class="dd-item ">
        <a href="/monitoring/promql/">
        PromQL 技巧
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
             
            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/log/" title="日志收集" class="dd-item 
        
        
        
        ">
      <a href="/log/">
          日志收集
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            




 
  
    
      <li data-nav-id="/log/loki-stack/" title="利用 Loki/Promtail/Grafana 收集分析日志" class="dd-item ">
        <a href="/log/loki-stack/">
        利用 Loki/Promtail/Grafana 收集分析日志
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/bigdata-ai/" title="大数据与 AI" class="dd-item 
        
        
        
        ">
      <a href="/bigdata-ai/">
          大数据与 AI
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/bigdata-ai/flink-on-kubernetes/" title="Flink on Kubernetes" class="dd-item 
        
        
        
        ">
      <a href="/bigdata-ai/flink-on-kubernetes/">
          Flink on Kubernetes
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            




 
  
    
      <li data-nav-id="/bigdata-ai/flink-on-kubernetes/intro/" title="Flink 介绍" class="dd-item ">
        <a href="/bigdata-ai/flink-on-kubernetes/intro/">
        Flink 介绍
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/bigdata-ai/flink-on-kubernetes/flink-on-kubernetes/" title="Flink on Kubernetes 方案" class="dd-item ">
        <a href="/bigdata-ai/flink-on-kubernetes/flink-on-kubernetes/">
        Flink on Kubernetes 方案
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/bigdata-ai/flink-on-kubernetes/session-cluster/" title="Session Cluster 模式部署" class="dd-item ">
        <a href="/bigdata-ai/flink-on-kubernetes/session-cluster/">
        Session Cluster 模式部署
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/bigdata-ai/flink-on-kubernetes/job-cluster/" title="Job Cluster 模式部署" class="dd-item ">
        <a href="/bigdata-ai/flink-on-kubernetes/job-cluster/">
        Job Cluster 模式部署
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/bigdata-ai/flink-on-kubernetes/native-kubernetes/" title="Native Kubernetes 模式部署" class="dd-item ">
        <a href="/bigdata-ai/flink-on-kubernetes/native-kubernetes/">
        Native Kubernetes 模式部署
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/dev/" title="开发指南" class="dd-item 
        
        
        
        ">
      <a href="/dev/">
          开发指南
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            




 
  
    
      <li data-nav-id="/dev/golang-build/" title="Go 语言编译原理与优化" class="dd-item ">
        <a href="/dev/golang-build/">
        Go 语言编译原理与优化
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/dev/client-go/" title="使用 client-go 开发 k8s 应用" class="dd-item ">
        <a href="/dev/client-go/">
        使用 client-go 开发 k8s 应用
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/reference/" title="References" class="dd-item 
        
        
        
        ">
      <a href="/reference/">
          References
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            




 
  
    
      <li data-nav-id="/reference/net-shell/" title="" class="dd-item ">
        <a href="/reference/net-shell/">
        
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
         
    </ul>

    
    

    
    <section id="prefooter">
      <hr/>
      <ul>
      
        <li>
          <a class="padding">
            <i class="fas fa-language fa-fw"></i>
          <div class="select-style">
            <select id="select-language" onchange="location = this.value;">
          
          
          
              
              
                  
                    
                    
                      <option id="zh" value="https://k8s.imroc.io/avoid/cases/kubernetes-overflow-and-drop/" selected>简体中文</option>
                    
                  
              
                  
              
          
        </select>
        <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
          width="255px" height="255px" viewBox="0 0 255 255" style="enable-background:new 0 0 255 255;" xml:space="preserve">
          <g>
            <g id="arrow-drop-down">
              <polygon points="0,63.75 127.5,191.25 255,63.75 		" />
            </g>
          </g>
        </svg>
        </div>
        </a>
        </li>
      
      
      
        <li><a class="padding" href="#" data-clear-history-toggle=""><i class="fas fa-history fa-fw"></i> 清理历史记录</a></li>
      
      </ul>
    </section>
    
    <section id="footer">
      
<center>

    
    <a class="github-button" href="https://github.com/imroc/kubernetes-practice-guide" data-icon="octicon-star"
        data-show-count="true" aria-label="Star imroc/kubernetes-practice-guide on GitHub">Star</a>

    
    <a class="github-button" href="https://github.com/imroc/kubernetes-practice-guide/fork"
        data-icon="octicon-repo-forked" data-show-count="true"
        aria-label="Fork imroc/kubernetes-practice-guide on GitHub">Fork</a>

</center>

<script async defer src="https://buttons.github.io/buttons.js"></script>

    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                  
                  
                  
                  <div id="top-github-link">
                    <a class="github-link" title='编辑当前页' href="https://github.com/imroc/kubernetes-practice-guide/edit/master/content/zh/avoid/cases/kubernetes-overflow-and-drop.md" target="blank">
                      <i class="fas fa-code-branch"></i>
                      <span id="top-github-link-text">编辑当前页</span>
                    </a>
                  </div>
                  
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            
            
          
          
            <a href='/'>Kubernetes 实践指南</a> > <a href='/avoid/'>避坑指南</a> > <a href='/avoid/cases/'>踩坑分享</a> > 神秘的溢出与丢包
          
         
          
         
          
         
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li><a href="#问题描述">问题描述</a></li>
    <li><a href="#猜测">猜测</a></li>
    <li><a href="#抓包">抓包</a></li>
    <li><a href="#syn-queue-与-accept-queue">syn queue 与 accept queue</a></li>
    <li><a href="#listen-与-accept">listen 与 accept</a></li>
    <li><a href="#linux-的-backlog">Linux 的 backlog</a></li>
    <li><a href="#队列溢出">队列溢出</a></li>
    <li><a href="#回到问题上来">回到问题上来</a></li>
    <li><a href="#somaxconn-的默认值很小">somaxconn 的默认值很小</a>
      <ul>
        <li><a href="#方式一-使用-k8s-sysctls-特性直接给-pod-指定内核参数">方式一: 使用 k8s sysctls 特性直接给 pod 指定内核参数</a></li>
        <li><a href="#方式二-使用-initcontainers-设置内核参数">方式二: 使用 initContainers 设置内核参数</a></li>
        <li><a href="#方式三-安装-tuning-cni-插件统一设置-sysctl">方式三: 安装 tuning CNI 插件统一设置 sysctl</a></li>
      </ul>
    </li>
    <li><a href="#nginx-的-backlog">nginx 的 backlog</a></li>
    <li><a href="#参考资料">参考资料</a></li>
  </ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              神秘的溢出与丢包
            </h1>
          

        



<h2 id="问题描述">问题描述</h2>
<p>有用户反馈大量图片加载不出来。</p>
<p>图片下载走的 k8s ingress，这个 ingress 路径对应后端 service 是一个代理静态图片文件的 nginx deployment，这个 deployment 只有一个副本，静态文件存储在 nfs 上，nginx 通过挂载 nfs 来读取静态文件来提供图片下载服务，所以调用链是：client &ndash;&gt; k8s ingress &ndash;&gt; nginx &ndash;&gt; nfs。</p>
<h2 id="猜测">猜测</h2>
<p>猜测: ingress 图片下载路径对应的后端服务出问题了。</p>
<p>验证：在 k8s 集群直接 curl nginx 的 pod ip，发现不通，果然是后端服务的问题！</p>
<h2 id="抓包">抓包</h2>
<p>继续抓包测试观察，登上 nginx pod 所在节点，进入容器的 netns 中：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e"># 拿到 pod 中 nginx 的容器 id</span>
$ kubectl describe pod tcpbench-6484d4b457-847gl | grep -A10 <span style="color:#e6db74">&#34;^Containers:&#34;</span> | grep -Eo <span style="color:#e6db74">&#39;docker://.*$&#39;</span> | head -n <span style="color:#ae81ff">1</span> | sed <span style="color:#e6db74">&#39;s/docker:\/\/\(.*\)$/\1/&#39;</span>
49b4135534dae77ce5151c6c7db4d528f05b69b0c6f8b9dd037ec4e7043c113e

<span style="color:#75715e"># 通过容器 id 拿到 nginx 进程 pid</span>
$ docker inspect -f <span style="color:#f92672">{{</span>.State.Pid<span style="color:#f92672">}}</span> 49b4135534dae77ce5151c6c7db4d528f05b69b0c6f8b9dd037ec4e7043c113e
<span style="color:#ae81ff">3985</span>

<span style="color:#75715e"># 进入 nginx 进程所在的 netns</span>
$ nsenter -n -t <span style="color:#ae81ff">3985</span>

<span style="color:#75715e"># 查看容器 netns 中的网卡信息，确认下</span>
$ ip a
1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu <span style="color:#ae81ff">65536</span> qdisc noqueue state UNKNOWN group default qlen <span style="color:#ae81ff">1000</span>
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
3: eth0@if11: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span style="color:#ae81ff">1500</span> qdisc noqueue state UP group default
    link/ether 56:04:c7:28:b0:3c brd ff:ff:ff:ff:ff:ff link-netnsid <span style="color:#ae81ff">0</span>
    inet 172.26.0.8/26 scope global eth0
       valid_lft forever preferred_lft forever
</code></pre></div><p>使用 tcpdump 指定端口 24568 抓容器 netns 中 eth0 网卡的包:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">tcpdump -i eth0 -nnnn -ttt port <span style="color:#ae81ff">24568</span>
</code></pre></div><p>在其它节点准备使用 nc 指定源端口为 24568 向容器发包：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">nc -u <span style="color:#ae81ff">24568</span> 172.16.1.21 <span style="color:#ae81ff">80</span>
</code></pre></div><p>观察抓包结果：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">00:00:00.000000 IP 10.0.0.3.24568 &gt; 172.16.1.21.80: Flags <span style="color:#f92672">[</span>S<span style="color:#f92672">]</span>, seq 416500297, win 29200, options <span style="color:#f92672">[</span>mss 1424,sackOK,TS val <span style="color:#ae81ff">3000206334</span> ecr 0,nop,wscale 9<span style="color:#f92672">]</span>, length <span style="color:#ae81ff">0</span>
00:00:01.032218 IP 10.0.0.3.24568 &gt; 172.16.1.21.80: Flags <span style="color:#f92672">[</span>S<span style="color:#f92672">]</span>, seq 416500297, win 29200, options <span style="color:#f92672">[</span>mss 1424,sackOK,TS val <span style="color:#ae81ff">3000207366</span> ecr 0,nop,wscale 9<span style="color:#f92672">]</span>, length <span style="color:#ae81ff">0</span>
00:00:02.011962 IP 10.0.0.3.24568 &gt; 172.16.1.21.80: Flags <span style="color:#f92672">[</span>S<span style="color:#f92672">]</span>, seq 416500297, win 29200, options <span style="color:#f92672">[</span>mss 1424,sackOK,TS val <span style="color:#ae81ff">3000209378</span> ecr 0,nop,wscale 9<span style="color:#f92672">]</span>, length <span style="color:#ae81ff">0</span>
00:00:04.127943 IP 10.0.0.3.24568 &gt; 172.16.1.21.80: Flags <span style="color:#f92672">[</span>S<span style="color:#f92672">]</span>, seq 416500297, win 29200, options <span style="color:#f92672">[</span>mss 1424,sackOK,TS val <span style="color:#ae81ff">3000213506</span> ecr 0,nop,wscale 9<span style="color:#f92672">]</span>, length <span style="color:#ae81ff">0</span>
00:00:08.192056 IP 10.0.0.3.24568 &gt; 172.16.1.21.80: Flags <span style="color:#f92672">[</span>S<span style="color:#f92672">]</span>, seq 416500297, win 29200, options <span style="color:#f92672">[</span>mss 1424,sackOK,TS val <span style="color:#ae81ff">3000221698</span> ecr 0,nop,wscale 9<span style="color:#f92672">]</span>, length <span style="color:#ae81ff">0</span>
00:00:16.127983 IP 10.0.0.3.24568 &gt; 172.16.1.21.80: Flags <span style="color:#f92672">[</span>S<span style="color:#f92672">]</span>, seq 416500297, win 29200, options <span style="color:#f92672">[</span>mss 1424,sackOK,TS val <span style="color:#ae81ff">3000237826</span> ecr 0,nop,wscale 9<span style="color:#f92672">]</span>, length <span style="color:#ae81ff">0</span>
00:00:33.791988 IP 10.0.0.3.24568 &gt; 172.16.1.21.80: Flags <span style="color:#f92672">[</span>S<span style="color:#f92672">]</span>, seq 416500297, win 29200, options <span style="color:#f92672">[</span>mss 1424,sackOK,TS val <span style="color:#ae81ff">3000271618</span> ecr 0,nop,wscale 9<span style="color:#f92672">]</span>, length <span style="color:#ae81ff">0</span>
</code></pre></div><p>SYN 包到容器内网卡了，但容器没回 ACK，像是报文到达容器内的网卡后就被丢了。看样子跟防火墙应该也没什么关系，也检查了容器 netns 内的 iptables 规则，是空的，没问题。</p>
<p>排除是 iptables 规则问题，在容器 netns 中使用 <code>netstat -s</code> 检查下是否有丢包统计:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ netstat -s | grep -E <span style="color:#e6db74">&#39;overflow|drop&#39;</span>
    <span style="color:#ae81ff">12178939</span> times the listen queue of a socket overflowed
    <span style="color:#ae81ff">12247395</span> SYNs to LISTEN sockets dropped
</code></pre></div><p>果然有丢包，为了理解这里的丢包统计，我深入研究了一下，下面插播一些相关知识。</p>
<h2 id="syn-queue-与-accept-queue">syn queue 与 accept queue</h2>
<p>Linux 进程监听端口时，内核会给它对应的 socket 分配两个队列：</p>
<ul>
<li>syn queue: 半连接队列。server 收到 SYN 后，连接会先进入 <code>SYN_RCVD</code> 状态，并放入 syn queue，此队列的包对应还没有完全建立好的连接（TCP 三次握手还没完成）。</li>
<li>accept queue: 全连接队列。当 TCP 三次握手完成之后，连接会进入 <code>ESTABELISHED</code> 状态并从 syn queue 移到 accept queue，等待被进程调用 <code>accept()</code> 系统调用 &ldquo;拿走&rdquo;。</li>
</ul>
<blockquote>
<p>注意：这两个队列的连接都还没有真正被应用层接收到，当进程调用 <code>accept()</code> 后，连接才会被应用层处理，具体到我们这个问题的场景就是 nginx 处理 HTTP 请求。</p>
</blockquote>
<p>为了更好理解，可以看下这张 TCP 连接建立过程的示意图：</p>
<p><img src="https://imroc.io/assets/blog/troubleshooting-k8s-network/backlog.png" alt=""></p>
<h2 id="listen-与-accept">listen 与 accept</h2>
<p>不管使用什么语言和框架，在写 server 端应用时，它们的底层在监听端口时最终都会调用 <code>listen()</code> 系统调用，处理新请求时都会先调用 <code>accept()</code> 系统调用来获取新的连接，然后再处理请求，只是有各自不同的封装而已，以 go 语言为例：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#75715e">// 调用 listen 监听端口
</span><span style="color:#75715e"></span><span style="color:#a6e22e">l</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">net</span>.<span style="color:#a6e22e">Listen</span>(<span style="color:#e6db74">&#34;tcp&#34;</span>, <span style="color:#e6db74">&#34;:80&#34;</span>)
<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
	panic(<span style="color:#a6e22e">err</span>)
}
<span style="color:#66d9ef">for</span> {
	<span style="color:#75715e">// 不断调用 accept 获取新连接，如果 accept queue 为空就一直阻塞
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">conn</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">l</span>.<span style="color:#a6e22e">Accept</span>()
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;accept error:&#34;</span>, <span style="color:#a6e22e">err</span>)
		<span style="color:#66d9ef">continue</span>
    }
	<span style="color:#75715e">// 每来一个新连接意味着一个新请求，启动协程处理请求
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">go</span> <span style="color:#a6e22e">handle</span>(<span style="color:#a6e22e">conn</span>)
}
</code></pre></div><h2 id="linux-的-backlog">Linux 的 backlog</h2>
<p>内核既然给监听端口的 socket 分配了 syn queue 与 accept queue 两个队列，那它们有大小限制吗？可以无限往里面塞数据吗？当然不行！ 资源是有限的，尤其是在内核态，所以需要限制一下这两个队列的大小。那么它们的大小是如何确定的呢？我们先来看下 listen 这个系统调用:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">int listen<span style="color:#f92672">(</span>int sockfd, int backlog<span style="color:#f92672">)</span>
</code></pre></div><p>可以看到，能够传入一个整数类型的 <code>backlog</code> 参数，我们再通过 <code>man listen</code> 看下解释：</p>
<p><code>The behavior of the backlog argument on TCP sockets changed with Linux 2.2.  Now it specifies the queue length for completely established sockets waiting to  be  accepted,  instead  of  the  number  of  incomplete  connection requests.   The  maximum  length  of  the queue for incomplete sockets can be set using /proc/sys/net/ipv4/tcp_max_syn_backlog.  When syncookies are enabled there is no logical maximum length and this setting is ignored.  See tcp(7) for more information. </code></p>
<p><code>If the backlog argument is greater than the value in /proc/sys/net/core/somaxconn, then it is silently truncated to that value; the default value in this file is 128.  In kernels before 2.4.25, this limit  was  a  hard  coded value, SOMAXCONN, with the value 128.</code></p>
<p>继续深挖了一下源码，结合这里的解释提炼一下：</p>
<ul>
<li>listen 的 backlog 参数同时指定了 socket 的 syn queue 与 accept queue 大小。</li>
<li>accept queue 最大不能超过 <code>net.core.somaxconn</code> 的值，即:
<pre><code>max accept queue size = min(backlog, net.core.somaxconn)
</code></pre></li>
<li>如果启用了 syncookies (net.ipv4.tcp_syncookies=1)，当 syn queue 满了，server 还是可以继续接收 <code>SYN</code> 包并回复 <code>SYN+ACK</code> 给 client，只是不会存入 syn queue 了。因为会利用一套巧妙的 syncookies 算法机制生成隐藏信息写入响应的 <code>SYN+ACK</code> 包中，等 client 回 <code>ACK</code> 时，server 再利用 syncookies 算法校验报文，校验通过后三次握手就顺利完成了。所以如果启用了 syncookies，syn queue 的逻辑大小是没有限制的，</li>
<li>syncookies 通常都是启用了的，所以一般不用担心 syn queue 满了导致丢包。syncookies 是为了防止 SYN Flood 攻击 (一种常见的 DDoS 方式)，攻击原理就是 client 不断发 SYN 包但不回最后的 ACK，填满 server 的 syn queue 从而无法建立新连接，导致 server 拒绝服务。</li>
<li>如果 syncookies 没有启用，syn queue 的大小就有限制，除了跟 accept queue 一样受 <code>net.core.somaxconn</code> 大小限制之外，还会受到 <code>net.ipv4.tcp_max_syn_backlog</code> 的限制，即:
<pre><code>max syn queue size = min(backlog, net.core.somaxconn, net.ipv4.tcp_max_syn_backlog)
</code></pre></li>
</ul>
<p>4.3 及其之前版本的内核，syn queue 的大小计算方式跟现在新版内核这里还不一样，详细请参考 commit <a href="https://github.com/torvalds/linux/commit/ef547f2ac16bd9d77a780a0e7c70857e69e8f23f#diff-56ecfd3cd70d57cde321f395f0d8d743L43">ef547f2ac16b</a></p>
<h2 id="队列溢出">队列溢出</h2>
<p>毫无疑问，在队列大小有限制的情况下，如果队列满了，再有新连接过来肯定就有问题。</p>
<p>翻下 linux 源码，看下处理 SYN 包的部分，在 <code>net/ipv4/tcp_input.c</code> 的 <code>tcp_conn_request</code> 函数:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#66d9ef">if</span> ((net<span style="color:#f92672">-&gt;</span>ipv4.sysctl_tcp_syncookies <span style="color:#f92672">==</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">||</span>
     inet_csk_reqsk_queue_is_full(sk)) <span style="color:#f92672">&amp;&amp;</span> <span style="color:#f92672">!</span>isn) {
	want_cookie <span style="color:#f92672">=</span> tcp_syn_flood_action(sk, rsk_ops<span style="color:#f92672">-&gt;</span>slab_name);
	<span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>want_cookie)
		<span style="color:#66d9ef">goto</span> drop;
}

<span style="color:#66d9ef">if</span> (sk_acceptq_is_full(sk)) {
	NET_INC_STATS(sock_net(sk), LINUX_MIB_LISTENOVERFLOWS);
	<span style="color:#66d9ef">goto</span> drop;
}
</code></pre></div><p><code>goto drop</code> 最终会走到 <code>tcp_listendrop</code> 函数，实际上就是将 <code>ListenDrops</code> 计数器 +1:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#66d9ef">static</span> <span style="color:#66d9ef">inline</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">tcp_listendrop</span>(<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">struct</span> sock <span style="color:#f92672">*</span>sk)
{
	atomic_inc(<span style="color:#f92672">&amp;</span>((<span style="color:#66d9ef">struct</span> sock <span style="color:#f92672">*</span>)sk)<span style="color:#f92672">-&gt;</span>sk_drops);
	__NET_INC_STATS(sock_net(sk), LINUX_MIB_LISTENDROPS);
}
</code></pre></div><p>大致可以看出来，对于 SYN 包：</p>
<ul>
<li>如果 syn queue 满了并且没有开启 syncookies 就丢包，并将 <code>ListenDrops</code> 计数器 +1。</li>
<li>如果 accept queue 满了也会丢包，并将 <code>ListenOverflows</code> 和 <code>ListenDrops</code> 计数器 +1。</li>
</ul>
<p>而我们前面排查问题通过 <code>netstat -s</code> 看到的丢包统计，其实就是对应的 <code>ListenOverflows</code> 和 <code>ListenDrops</code> 这两个计数器。</p>
<p>除了用 <code>netstat -s</code>，还可以使用 <code>nstat -az</code> 直接看系统内各个计数器的值:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ nstat -az | grep -E <span style="color:#e6db74">&#39;TcpExtListenOverflows|TcpExtListenDrops&#39;</span>
TcpExtListenOverflows           <span style="color:#ae81ff">12178939</span>              0.0
TcpExtListenDrops               <span style="color:#ae81ff">12247395</span>              0.0
</code></pre></div><p>另外，对于低版本内核，当 accept queue 满了，并不会完全丢弃 SYN 包，而是对 SYN 限速。把内核源码切到 3.10 版本，看 <code>net/ipv4/tcp_ipv4.c</code> 中 <code>tcp_v4_conn_request</code> 函数:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#75715e">/* Accept backlog is full. If we have already queued enough
</span><span style="color:#75715e"> * of warm entries in syn queue, drop request. It is better than
</span><span style="color:#75715e"> * clogging syn queue with openreqs with exponentially increasing
</span><span style="color:#75715e"> * timeout.
</span><span style="color:#75715e"> */</span>
<span style="color:#66d9ef">if</span> (sk_acceptq_is_full(sk) <span style="color:#f92672">&amp;&amp;</span> inet_csk_reqsk_queue_young(sk) <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">1</span>) {
        NET_INC_STATS_BH(sock_net(sk), LINUX_MIB_LISTENOVERFLOWS);
        <span style="color:#66d9ef">goto</span> drop;
}
</code></pre></div><p>其中 <code>inet_csk_reqsk_queue_young(sk) &gt; 1</code> 的条件实际就是用于限速，仿佛在对 client 说: 哥们，你慢点！我的 accept queue 都满了，即便咱们握手成功，连接也可能放不进去呀。</p>
<h2 id="回到问题上来">回到问题上来</h2>
<p>总结之前观察到两个现象：</p>
<ul>
<li>容器内抓包发现收到 client 的 SYN，但 nginx 没回包。</li>
<li>通过 <code>netstat -s</code> 发现有溢出和丢包的统计 (<code>ListenOverflows</code> 与 <code>ListenDrops</code>)。</li>
</ul>
<p>根据之前的分析，我们可以推测是 syn queue 或 accept queue 满了。</p>
<p>先检查下 syncookies 配置:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ cat /proc/sys/net/ipv4/tcp_syncookies
<span style="color:#ae81ff">1</span>
</code></pre></div><p>确认启用了 <code>syncookies</code>，所以 syn queue 大小没有限制，不会因为 syn queue 满而丢包，并且即便没开启 <code>syncookies</code>，syn queue 有大小限制，队列满了也不会使 <code>ListenOverflows</code> 计数器 +1。</p>
<p>从计数器结果来看，<code>ListenOverflows</code> 和 <code>ListenDrops</code> 的值差别不大，所以推测很有可能是 accept queue 满了，因为当 accept queue 满了会丢 SYN 包，并且同时将 <code>ListenOverflows</code> 与 <code>ListenDrops</code> 计数器分别 +1。</p>
<p>如何验证 accept queue 满了呢？可以在容器的 netns 中执行 <code>ss -lnt</code> 看下:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ ss -lnt
State      Recv-Q Send-Q Local Address:Port                Peer Address:Port
LISTEN     <span style="color:#ae81ff">129</span>    <span style="color:#ae81ff">128</span>                *:80                             *:*
</code></pre></div><p>通过这条命令我们可以看到当前 netns 中监听 tcp 80 端口的 socket，<code>Send-Q</code> 为 128，<code>Recv-Q</code> 为 129。</p>
<p>什么意思呢？通过调研得知：</p>
<ul>
<li>对于 <code>LISTEN</code> 状态，<code>Send-Q</code> 表示 accept queue 的最大限制大小，<code>Recv-Q</code> 表示其实际大小。</li>
<li>对于 <code>ESTABELISHED</code> 状态，<code>Send-Q</code> 和 <code>Recv-Q</code> 分别表示发送和接收数据包的 buffer。</li>
</ul>
<p>所以，看这里输出结果可以得知 accept queue 满了，当 <code>Recv-Q</code> 的值比 <code>Send-Q</code> 大 1 时表明 accept queue 溢出了，如果再收到 SYN 包就会丢弃掉。</p>
<p>导致 accept queue 满的原因一般都是因为进程调用 <code>accept()</code> 太慢了，导致大量连接不能被及时 &ldquo;拿走&rdquo;。</p>
<p>那么什么情况下进程调用 <code>accept()</code> 会很慢呢？猜测可能是进程连接负载高，处理不过来。</p>
<p>而负载高不仅可能是 CPU 繁忙导致，还可能是 IO 慢导致，当文件 IO 慢时就会有很多 IO WAIT，在 IO WAIT 时虽然 CPU 不怎么干活，但也会占据 CPU 时间片，影响 CPU 干其它活。</p>
<p>最终进一步定位发现是 nginx pod 挂载的 nfs 服务对应的 nfs server 负载较高，导致 IO 延时较大，从而使 nginx 调用 <code>accept()</code> 变慢，accept queue 溢出，使得大量代理静态图片文件的请求被丢弃，也就导致很多图片加载不出来。</p>
<p>虽然根因不是 k8s 导致的问题，但也从中挖出一些在高并发场景下值得优化的点，请继续往下看。</p>
<h2 id="somaxconn-的默认值很小">somaxconn 的默认值很小</h2>
<p>我们再看下之前 <code>ss -lnt</code> 的输出:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ ss -lnt
State      Recv-Q Send-Q Local Address:Port                Peer Address:Port
LISTEN     <span style="color:#ae81ff">129</span>    <span style="color:#ae81ff">128</span>                *:80                             *:*
</code></pre></div><p>仔细一看，<code>Send-Q</code> 表示 accept queue 最大的大小，才 128 ？也太小了吧！</p>
<p>根据前面的介绍我们知道，accept queue 的最大大小会受 <code>net.core.somaxconn</code> 内核参数的限制，我们看下 pod 所在节点上这个内核参数的大小:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ cat /proc/sys/net/core/somaxconn
<span style="color:#ae81ff">32768</span>
</code></pre></div><p>是 32768，挺大的，为什么这里 accept queue 最大大小就只有 128 了呢？</p>
<p><code>net.core.somaxconn</code> 这个内核参数是 namespace 隔离了的，我们在容器 netns 中再确认了下：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ cat /proc/sys/net/core/somaxconn
<span style="color:#ae81ff">128</span>
</code></pre></div><p>为什么只有 128？看下 stackoverflow <a href="https://stackoverflow.com/questions/26177059/refresh-net-core-somaxcomm-or-any-sysctl-property-for-docker-containers/26197875#26197875">这里</a> 的讨论:</p>
<p><code>The &quot;net/core&quot; subsys is registered per network namespace. And the initial value for somaxconn is set to 128.</code></p>
<p>原来新建的 netns 中 somaxconn 默认就为 128，在 <code>include/linux/socket.h</code> 中可以看到这个常量的定义:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#75715e">/* Maximum queue length specifiable by listen.  */</span>
<span style="color:#75715e">#define SOMAXCONN	128
</span></code></pre></div><p>很多人在使用 k8s 时都没太在意这个参数，为什么大家平常在较高并发下也没发现有问题呢？</p>
<p>因为通常进程 <code>accept()</code> 都是很快的，所以一般 accept queue 基本都没什么积压的数据，也就不会溢出导致丢包了。</p>
<p>对于并发量很高的应用，还是建议将 somaxconn 调高。虽然可以进入容器 netns 后使用 <code>sysctl -w net.core.somaxconn=1024</code> 或 <code>echo 1024 &gt; /proc/sys/net/core/somaxconn</code> 临时调整，但调整的意义不大，因为容器内的进程一般在启动的时候才会调用 <code>listen()</code>，然后 accept queue 的大小就被决定了，并且不再改变。</p>
<p>下面介绍几种调整方式:</p>
<h3 id="方式一-使用-k8s-sysctls-特性直接给-pod-指定内核参数">方式一: 使用 k8s sysctls 特性直接给 pod 指定内核参数</h3>
<p>示例 yaml:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#66d9ef">apiVersion</span>: v1
<span style="color:#66d9ef">kind</span>: Pod
<span style="color:#66d9ef">metadata</span>:
  <span style="color:#66d9ef">name</span>: sysctl-example
<span style="color:#66d9ef">spec</span>:
  <span style="color:#66d9ef">securityContext</span>:
    <span style="color:#66d9ef">sysctls</span>:
    - <span style="color:#66d9ef">name</span>: net.core.somaxconn
      <span style="color:#66d9ef">value</span>: <span style="color:#e6db74">&#34;8096&#34;</span>
</code></pre></div><p>有些参数是 <code>unsafe</code> 类型的，不同环境不一样，我的环境里是可以直接设置 pod 的 <code>net.core.somaxconn</code> 这个 sysctl 的。如果你的环境不行，请参考官方文档 <a href="https://kubernetes-io-vnext-staging.netlify.com/docs/tasks/administer-cluster/sysctl-cluster/#enabling-unsafe-sysctls">Using sysctls in a Kubernetes Cluster</a> 启用 <code>unsafe</code> 类型的 sysctl。</p>
<blockquote>
<p>注：此特性在 k8s v1.12 beta，默认开启。</p>
</blockquote>
<h3 id="方式二-使用-initcontainers-设置内核参数">方式二: 使用 initContainers 设置内核参数</h3>
<p>示例 yaml:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#66d9ef">apiVersion</span>: v1
<span style="color:#66d9ef">kind</span>: Pod
<span style="color:#66d9ef">metadata</span>:
  <span style="color:#66d9ef">name</span>: sysctl-example-init
<span style="color:#66d9ef">spec</span>:
  <span style="color:#66d9ef">initContainers</span>:
  - <span style="color:#66d9ef">image</span>: busybox
    <span style="color:#66d9ef">command</span>:
    - sh
    - -c
    - echo <span style="color:#ae81ff">1024</span> &gt; /proc/sys/net/core/somaxconn
    <span style="color:#66d9ef">imagePullPolicy</span>: Always
    <span style="color:#66d9ef">name</span>: setsysctl
    <span style="color:#66d9ef">securityContext</span>:
      <span style="color:#66d9ef">privileged</span>: <span style="color:#66d9ef">true</span>
  <span style="color:#66d9ef">Containers</span>:
  ...
</code></pre></div><blockquote>
<p>注: init container 需要 privileged 权限。</p>
</blockquote>
<h3 id="方式三-安装-tuning-cni-插件统一设置-sysctl">方式三: 安装 tuning CNI 插件统一设置 sysctl</h3>
<p>tuning plugin 地址: <a href="https://github.com/containernetworking/plugins/tree/master/plugins/meta/tuning">https://github.com/containernetworking/plugins/tree/master/plugins/meta/tuning</a></p>
<p>CNI 配置示例:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">{</span>
  <span style="color:#e6db74">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;mytuning&#34;</span>,
  <span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;tuning&#34;</span>,
  <span style="color:#e6db74">&#34;sysctl&#34;</span>: <span style="color:#f92672">{</span>
          <span style="color:#e6db74">&#34;net.core.somaxconn&#34;</span>: <span style="color:#e6db74">&#34;1024&#34;</span>
  <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><h2 id="nginx-的-backlog">nginx 的 backlog</h2>
<p>我们使用方式一尝试给 nginx pod 的 somaxconn 调高到 8096 后观察:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ ss -lnt
State      Recv-Q Send-Q Local Address:Port                Peer Address:Port
LISTEN     <span style="color:#ae81ff">512</span>    <span style="color:#ae81ff">511</span>                *:80                             *:*
</code></pre></div><p>WTF? 还是溢出了，而且调高了 somaxconn 之后虽然 accept queue 的最大大小 (<code>Send-Q</code>) 变大了，但跟 8096 还差很远呀！</p>
<p>在经过一番研究，发现 nginx 在 <code>listen()</code> 时并没有读取 somaxconn 作为 backlog 默认值传入，它有自己的默认值，也支持在配置里改。通过 <a href="http://nginx.org/en/docs/http/ngx_http_core_module.html">ngx_http_core_module</a> 的官方文档我们可以看到它在 linux 下的默认值就是 511:</p>
<pre><code>backlog=number
   sets the backlog parameter in the listen() call that limits the maximum length for the queue of pending connections. By default, backlog is set to -1 on FreeBSD, DragonFly BSD, and macOS, and to 511 on other platforms.
</code></pre><p>配置示例:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">listen  <span style="color:#ae81ff">80</span>  default  backlog<span style="color:#f92672">=</span>1024;
</code></pre></div><p>所以，在容器中使用 nginx 来支撑高并发的业务时，记得要同时调整下 <code>net.core.somaxconn</code> 内核参数和 <code>nginx.conf</code> 中的 backlog 配置。</p>
<h2 id="参考资料">参考资料</h2>
<ul>
<li>Using sysctls in a Kubernetes Cluster: <a href="https://kubernetes-io-vnext-staging.netlify.com/docs/tasks/administer-cluster/sysctl-cluster/">https://kubernetes-io-vnext-staging.netlify.com/docs/tasks/administer-cluster/sysctl-cluster/</a></li>
<li>SYN packet handling in the wild: <a href="https://blog.cloudflare.com/syn-packet-handling-in-the-wild/">https://blog.cloudflare.com/syn-packet-handling-in-the-wild/</a></li>
</ul>

<footer class="footline">
	
	
	
	<i class='fas fa-user'></i> <a href="https://imroc.io">roc</a>
    
	
</footer>

        
        </div> 
       
         <div class="entry-shang text-center">
    <p>「真诚赞赏，手留余香」</p>
    <button class="zs show-zs btn btn-bred">赞赏</button>
</div>
<div class="zs-modal-bg"></div>
<div class="zs-modal-box">
    <div class="zs-modal-head">
        <button type="button" class="close">×</button>
        <span class="author"><img
                src="https://res.cloudinary.com/imroc/image/upload/c_scale,w_128/v1583303821/img/favicon.jpg" />roc</span>
        <p class="tip"><i></i><span>请我喝杯咖啡？</span></p>
    </div>
    <div class="zs-modal-body">
        <div class="zs-modal-btns">
            <button class="btn btn-blink" data-num="2">2元</button>
            <button class="btn btn-blink" data-num="5">5元</button>
            <button class="btn btn-blink" data-num="10">10元</button>
            <button class="btn btn-blink" data-num="50">50元</button>
            <button class="btn btn-blink" data-num="100">100元</button>
            <button class="btn btn-blink" data-num="1">任意金额</button>
        </div>
        <div class="zs-modal-pay">
            <button class="btn btn-bred" id="pay-text">2元</button>
            <p>使用<span id="pay-type">微信</span>扫描二维码完成支付</p>
            <img src="/img/wechat-2.png" id="pay-image"/>
        </div>
    </div>
    <div class="zs-modal-footer">
        <label>
            <input type="radio" name="zs-type" value="wechat" class="zs-type" checked="checked">
            <span class="zs-wechat"><img src="/img/wechat-btn.png" /></span>
        </label>
        <label>
            <input type="radio" name="zs-type" value="alipay" class="zs-type">
            <span class="zs-alipay"><img src="/img/alipay-btn.png" /></span>
        </label>
    </div>
</div>
       
        
          <div id="gitalk-container"></div>
<link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
<script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
<script>
  
  console.log("gitalk id:e35b6c210080d1249640fc33721f441c")
  var gitalk = new Gitalk({
      clientID: '6e0166abfd4b13fb3f6e',
      clientSecret: '9960a67408e0cc826566869e0e3247017004d007',
      repo: 'kubernetes-practice-guide',
      owner: 'imroc',
      admin: ["imroc"],
      labels: ['Gitalk'],
      title: '神秘的溢出与丢包',
      createIssueManually: false,
      id: 'e35b6c210080d1249640fc33721f441c',
      distractionFreeMode: true
  });
  gitalk.render('gitalk-container');
</script>
        
      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
        
        


	 
	 
		
			<a class="nav nav-prev" href="/avoid/cases/high-legacy-from-pod-to-another-apiserver/" title="Pod 访问另一个集群的 apiserver 有延时"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="/avoid/cases/lb-with-local-externaltrafficpolicy-timeout-occasionally/" title="访问 externalTrafficPolicy 为 Local 的 Service 对应 LB 有时超时" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>

    

  </body>
</html>